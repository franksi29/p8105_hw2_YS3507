---
title: "hw2"
author: "Yu Si"
date: "10/9/2021"
output: github_document
---
```{r}
library(tidyverse)
library(readxl)
library(haven)
```

# Problem 1
```{r}
# Read and clean the Mr. Trash Wheel sheet
trash_data = read_excel("./Trash-Wheel-Collection-Totals-7-2020-2.xlsx", col_names = TRUE, range = "A2:N534")%>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = round(sports_balls))

#Read and clean precipitation data for 2018 and 2019. 
data_2018 = read_excel("./Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = 7, range = "A2:B14") %>% 
  drop_na() %>% 
  mutate(Year = "2018")
data_2019 = read_excel("./Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = 6, range = "A2:B14") %>% 
  drop_na() %>% 
  mutate(Year = "2019")

#Combine precipitation datasets and convert month to a character variable 
data_2018_2019 = bind_rows(data_2018, data_2019) %>% 
  mutate(Month = month.name[Month])

total_2018 = sum(pull(data_2018, Total))
trash_2019 = filter(trash_data, year == "2019")
sports_balls_median_2019 = median(pull(trash_2019, sports_balls))
```

In the trash_data, there are 344 rows and 14 columns. There are "dumpster","month","year", "date", "weight_tons", "volume_cubic_yards", "plastic_bottles", "polystyrene", "cigarette_butts", "glass_bottles", "grocery_bags", "chip_bags", "sports_balls", "homes_powered" observations. 
In data_2018, there are 6 rows and 3 columns. There are "Month" "Total" "Year" observations. 
In data_2019, there are 12 rows and 14 columns. There are "Month" "Total" "Year" observations. 
the total precipitation in 2018 is 70.33.
the median number of sports balls in a dumpster in 2019 is 9.

# Problem 2
```{r}
# clean the data in pols-month.csv. 
pols_month = read_csv("pols-month.csv") %>% 
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month","day")) %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  mutate(president = ifelse(prez_gop==1, "gop", "dem")) %>% 
  select(-prez_dem) %>% 
  select(-prez_gop) %>% 
  select(-day)

# clean the data in snp.csv
snp <- read_csv("snp.csv")%>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month","day","year")) %>% 
    arrange(year, month) %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  relocate(year, month) %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(year = ifelse(
    year >30, year + 1900 , year + 2000
  )) %>% 
  mutate(year = as.character(year))
  

# year_format = pull(snp, year)
# year_format = as.numeric(year_format)
# year_format = ifelse(year_format>30, year_format+1900, year_format+2000)
# year_format = as.character(year_format)
# snp = select(snp, -year )%>% 
#   mutate(year = year_format) %>% 
#   relocate(year, month)

# tidy the unemployment data so that it can be merged with the previous datasets.                
unemployment_data = read_csv("unemployment.csv") %>% 
  janitor::clean_names() %>%
  pivot_longer(jan:dec,
                names_to = "month",
                values_to = "unemployment") %>% 
  mutate(month, month = recode(month, "jan"="January", "feb" = "February",  "mar" = "March", "apr" = "April",  "may" = "May", "jun" = "June" , "jul" = "July", "aug"= "August",  "sep" = "September",  "oct"="October" , "nov" = "November", "dec" = "December")) %>% 
  mutate(year = as.character(year)) %>% 
  relocate(year, month)

# tidy the unemployment data so that it can be merged with the previous datasets. 
snp_pols_unemployment_data = pols_month %>% 
  left_join(snp) %>% 
  left_join(unemployment_data)


```
In the first dataset, pols_month, there are 822 rows and 9 columns. it contains year, month, date, and relative number of senators, representatives, governors in two parties. 

In the second dataset, snp, there are 787 rows and 4 columns. it contains year, month, date and close value. 

In the third dataset, unemployment, there are 816 rows and 3 columns. it contains year, month and unemployment value. 

In the resulting dataset, there are 822 rows and 12 columns. the range of years is from 1947 to 2015. the key variables are "year" , "month" , "gov_gop", "sen_gop", "rep_gop", "gov_dem", "sen_dem", "rep_dem", "president", "day",  "close",  "unemployment".

# Problem 3
```{r}
baby_data = read_csv("Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  distinct() %>% 
  arrange(year_of_birth) %>% 
  mutate(ethnicity = str_to_lower(ethnicity)) %>% 
  mutate(childs_first_name = str_to_lower(childs_first_name)) %>% 
  mutate(gender = str_to_lower(gender)) %>% 
  mutate(ethnicity, ethnicity = recode(ethnicity, "black non hisp" = "black non hispanic", "white non hisp" = "white non hispanic", "asian and paci" = "asian and pacific islander"))

olivia_data = filter(baby_data, childs_first_name == "olivia") %>% 
  select(-gender, -count, -childs_first_name) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  )
  
male_most_data = filter(baby_data, gender == "male", rank == "1")  %>% 
  select(-gender, -rank, -count) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  )

male_non_hispanic_2016 = filter(baby_data, year_of_birth == "2016", gender =="male", ethnicity != "hispanic" )
ggplot(male_non_hispanic_2016, aes(x = pull(male_non_hispanic_2016, rank), y = pull(male_non_hispanic_2016, count))) + geom_point()
```

